# Telegram Bot для поиска фильмов

Бот лежит тут: @HW3_MovieBot, среднее время ответа 1.3-1.7 секунды.

---

## Команды

| Команда                     | Описание                                                      |
|-----------------------------|--------------------------------------------------------------|
| `/start`                    | Запустить бота и инициализировать профиль пользователя.      |
| `/help`                     | Получить список доступных команд.                            |
| `/random`                   | Получить случайный фильм для просмотра.                      |
| `/history`                  | Просмотреть историю поиска фильмов.                          |
| `/watch_later`              | Просмотреть список "Посмотреть позже".                       |
| `/add_to_watch_later`       | Добавить последний найденный фильм в "Посмотреть позже".     |
| `/delete_from_watch_later X` | Удалить фильм (по номеру `X`) из списка "Посмотреть позже".  |
| `<название>`                | Найти фильм по названию.                                      |

---

## Реализация поиска фильмов

Основные методы:

1. **`get_film_by_name(name: str) -> tp.Optional[FilmInfo]`**
   - Выполняет поиск фильма по названию, использует API Кинопоиска.
   - Возвращает информацию о первом найденном фильме в формате `FilmInfo`.

2. **`get_random_film() -> tp.Optional[FilmInfo]`**
   - Получает случайный фильм, фильтруя результаты по минимальному количеству голосов и наличию описания, в реализации я так же пользовался API Кинопоиска.

3. **`find_lordfilm(film: FilmInfo) -> tp.Optional[str]`**
   - Выполняет поиск ссылки на фильм на сайте LordFilm через Google (используется запрос вида <название> <год> lordfilm).
   - Проверяет найденные ссылки на доступность.

4. **`find_zona(film: FilmInfo) -> tp.Optional[str]`**
   - Выполняет поиск фильма на сайте Zona по названию и году выпуска.
   - Возвращает прямую ссылку на страницу фильма.

Эти методы используют библиотеку `aiohttp` для асинхронных HTTP-запросов и `BeautifulSoup` для парсинга HTML-страниц.

---

# Web-приложение

Это асинхронное веб-приложение на базе Quart во многом повторяющее функционал бота, в котором реализовано вход с помощью телеграмма, поиск фильмов и сохранение их в личную историю или список «Посмотреть позже». Использует данные с Кинопоиска, а также ресурсы zona и lordfilm для получения ссылок.

---
## Возможности

- Авторизация через Telegram (`Telegram Login Widget`)
- Поиск фильмов по названию
- История запросов по каждому пользователю
- Добавление фильма в список «Посмотреть позже»
- Удаление фильма из списка
- Асинхронная обработка запросов (`Quart`)
- Простое шаблонное оформление (Jinja2)

## Технологии

- Python 3.10+
- Quart
- Quart-Auth
- Async SQLite (через `aiosqlite`)
- Telegram Login авторизация (HMAC проверка)
- Bootstrap (в шаблонах)

---

## URL-маршруты

| Маршрут                      | Описание                                   |
|-----------------------------|--------------------------------------------|
| `/`                         | Главная страница и форма поиска            |
| `/auth`                     | Обработка Telegram логина                  |
| `/login_page`              | Ручной вход (если не авторизован)         |
| `/logout`                  | Выход из аккаунта                         |
| `/search?query=...`        | Отображение результатов поиска            |
| `/add_watch_later/<name>/<year>` | Добавить фильм в «Посмотреть позже» |
| `/delete_watch_later/<id>` | Удалить из «Посмотреть позже»             |
| `/watch_later`             | Список отложенных фильмов                 |
| `/history`                 | История всех запросов                     |
